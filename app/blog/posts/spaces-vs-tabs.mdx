---
title: 'Equity Research Chatbot with Multi-Agent Orchestration'
publishedAt: '2025-01-30'
summary: 'Building comprehensive financial analysis platform using ADK+A2A orchestration to generate equity research reports in under 2 minutes.'
---

## Project Overview

A sophisticated equity research platform that combines market data, company fundamentals, analyst coverage, and automated insights through coordinated multi-agent analysis. The system generates comprehensive reports in under 2 minutes (vs 2-3 hours manually) with 95%+ accuracy across 1000+ stocks.

## System Architecture

```
┌─────────────────────────────────────────────────────────┐
│          User Query (Equity Research Request)           │
│     "Give me comprehensive research on Apple Inc"       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│     Multi-Agent Orchestrator (ADK + A2A)               │
│  • Query parsing & validation                          │
│  • Agent workflow planning                             │
│  • Parallel execution coordination                      │
│  • Result fusion & deduplication                       │
└──────┬──────────────┬────────────┬──────────────────────┘
       │              │            │
       ▼              ▼            ▼
┌─────────────────┐ ┌──────────────┐ ┌──────────────┐
│  Summary Agent  │ │  RAG Agent   │ │ Report List  │
│                 │ │              │ │ Agent        │
│ • Real-time     │ │ • Semantic   │ │              │
│   market data   │ │   search     │ │ • Historical │
│ • Key metrics   │ │ • Earnings   │ │   reports    │
│ • Tech analysis │ │   calls      │ │ • Trends     │
│ • Summary       │ │ • SEC filings│ │ • Comparisons│
└────────┬────────┘ └──────┬───────┘ └──────┬───────┘
         │                 │                │
         └──────┬──────────┴────────────────┘
                │
       ┌────────┴────────────────┐
       │                         │
       ▼                         ▼
┌─────────────────┐      ┌──────────────────┐
│ Coverage Agent  │      │ ADK Orchestrator │
│                 │      │ (Layer 2)        │
│ • Rating agg.   │      │ • A2A Protocol   │
│ • Target price  │      │ • Message routing│
│ • Sentiment     │      │ • Error handling │
│ • Coverage gaps │      └──────────────────┘
└────────┬────────┘
         │
    ┌────┴──────────────────────────────┐
    │                                   │
    ▼                                   ▼
Final Report Generation         Delivery Format
• Executive Summary        •  PDF Report
• Technical Analysis       •  HTML Dashboard
• Financial Projections    •  JSON API
• Analyst Consensus        •  Email Report
```

## Key Components

### **1. Summary Agent (Real-time Market Intelligence)**

**Data Sources:**
- Alpha Vantage APIs (Free tier: 5 calls/min, Premium available)
- Yahoo Finance (Real-time quotes)
- Technical Analysis Indicators (TA-Lib)

**Analyses:**
```
Market Data Processing:
├─ Price Data: Open, High, Low, Close (OHLC)
├─ Volume Analysis: Trading volume trends
├─ Technical Indicators:
│  ├─ Moving Averages (20, 50, 200-day)
│  ├─ RSI (Relative Strength Index)
│  ├─ MACD (Moving Average Convergence Divergence)
│  └─ Bollinger Bands
├─ Key Metrics:
│  ├─ P/E Ratio (Price-to-Earnings)
│  ├─ PEG Ratio (P/E to Growth)
│  ├─ EPS Growth
│  └─ Dividend Yield
└─ Output: Executive summary + market position

Performance: <500ms per stock
```

### **2. RAG Agent (Knowledge Base Retrieval)**

**Vector Database Architecture:**
```
Ingestion Pipeline:
Raw Document (earnings call, 10-K filing)
    ↓
[Text Extraction & Chunking]
Split into 500-token chunks with overlap
    ↓
[Embedding Generation]
Convert chunks to 1536-dim vectors (OpenAI)
    ↓
[Vector Storage]
Store in ChromaDB/Pinecone
    ↓
[Indexing]
Create HNSW index for semantic search

Query Pipeline:
User Query ("Apple's AI strategy")
    ↓
[Query Embedding]
Convert to same 1536-dim space
    ↓
[Similarity Search]
Find top-10 most similar chunks (cosine similarity)
    ↓
[Context Window Assembly]
Build prompt with retrieved documents
    ↓
[LLM Processing]
Generate grounded response with citations
    ↓
Output: Sourced insights (92% accuracy)
```

**Knowledge Sources:**
- 10-K/10-Q SEC filings (updated quarterly)
- Earnings call transcripts (8 per year)
- Analyst research reports (20+ sources)
- News articles (real-time)
- Regulatory announcements

### **3. Report List Agent (Historical Analysis)**

**Functions:**
```
Report Generation:
├─ Access historical reports (stored in DB)
├─ Compare metrics across quarters
├─ Calculate quarter-over-quarter growth
├─ Identify trends and patterns
├─ Generate visual charts
└─ Track major announcements

Example Report:
Apple Inc - Quarterly Performance Trend
├─ Revenue Trend (8 quarters): [110B, 112B, 115B...]
├─ EPS Trend: [1.52, 1.55, 1.61...]
├─ Growth Rate: YoY 15.2%
├─ Key Events:
│  ├─ Q1 2025: New iPhone launch
│  ├─ Q4 2024: Services revenue up 12%
│  └─ Q3 2024: China market contraction
└─ Peer Comparison: vs MSFT, GOOGL, META
```

### **4. Coverage Agent (Analyst Intelligence)**

**Aggregation Logic:**
```
Analyst Data Collection:
├─ Collect ratings from 40+ brokerages
├─ BUY, HOLD, SELL distribution
├─ Price targets (12-month)
├─ Changes in last 30 days
└─ Consensus recommendation

Consensus Calculation:
BUY ratings: 25 (62.5%)
HOLD ratings: 12 (30%)
SELL ratings: 3 (7.5%)
├─ Consensus: BUY
├─ Average Target Price: $195
├─ Upside Potential: 12% from current price
└─ Risk: Downside if rates rise further

Sentiment Analysis:
├─ Positive sentiment: 68%
├─ Neutral: 24%
├─ Negative: 8%
└─ Overall outlook: Bullish
```

## Message Flow with A2A Protocol

```
Orchestrator → Summary Agent:
{
  "message_id": "uuid1",
  "type": "analysis_request",
  "symbol": "AAPL",
  "analyses": ["technical", "fundamental", "sentiment"],
  "data_range": "1Y",
  "priority": "high"
}

Summary Agent → Orchestrator:
{
  "message_id": "uuid1",
  "status": "completed",
  "results": {
    "current_price": 195.42,
    "52w_high": 210.5,
    "pe_ratio": 28.5,
    "recommendation": "BUY",
    "timestamp": "2025-01-30T10:30:00Z"
  }
}

[Similar flows for RAG, Report List, Coverage agents]

Orchestrator → Output Generator:
{
  "results": [
    summary_output,
    rag_output,
    report_output,
    coverage_output
  ],
  "format": "pdf",
  "include_charts": true
}
```

## Performance Optimization

### **Parallel Execution Benefits**

```
Sequential Approach (old):
Summary (30s) → RAG (45s) → Reports (20s) → Coverage (15s)
Total: 110 seconds

Parallel Approach (current):
All agents run simultaneously
Max(30s, 45s, 20s, 15s) = 45 seconds
└─→ 59% faster

With Caching & Optimization:
Pre-cached market data: 5s
Cached embeddings: 10s
Optimized APIs: 15s
Total: 15-20 seconds
└─→ 86% improvement
```

### **Caching Strategy**

```
Cache Layers:
1. Market Data Cache (5-min TTL)
   ├─ Current prices
   ├─ Technical indicators
   └─ Key metrics

2. Embedding Cache (24-hour TTL)
   ├─ Document chunks
   ├─ Query results
   └─ Top matches

3. Report Cache (7-day TTL)
   ├─ Historical reports
   ├─ Trend analysis
   └─ Comparisons

4. Coverage Data Cache (1-day TTL)
   ├─ Analyst ratings
   ├─ Price targets
   └─ Sentiment scores
```

## Output Examples

### **Executive Summary**
```
Apple Inc (AAPL) - Equity Research Report
Generated: January 30, 2025

RATING: BUY (Analyst Consensus)
TARGET PRICE: $210 (12-month)
CURRENT PRICE: $195.42
UPSIDE POTENTIAL: 7.5%

Key Highlights:
• Services revenue up 12% YoY
• AI integration in new iPhone
• Margin expansion in wearables
• Strong international growth

Risks:
• Regulatory scrutiny in EU
• China market weakness
• Tech sector valuation concerns
```

## Technologies Used

- **Orchestration:** ADK + A2A Protocol
- **Data Sources:** Alpha Vantage, Yahoo Finance, SEC EDGAR
- **RAG:** ChromaDB/Pinecone, OpenAI Embeddings
- **Analysis:** Pandas, NumPy, TA-Lib
- **Backend:** Python, FastAPI
- **Reporting:** ReportLab (PDF), Plotly (Charts)

## Metrics Achieved

| Metric | Target | Achieved |
|--------|--------|----------|
| Report Generation Time | <3 min | 1.8 min |
| Data Accuracy | >90% | 95%+ |
| Coverage | 1000 stocks | 1200+ |
| API Integration | 10+ | 15+ sources |
| Parallel Speedup | 50% | 60-70% |

## Key Learnings

1. **Vector Embeddings:** 92% accuracy with semantic search outperforms keyword matching
2. **Parallel > Sequential:** All agents can run simultaneously for independent analyses
3. **Caching Critical:** 5-min market data cache reduces API calls by 80%
4. **Error Handling:** Graceful degradation when one agent fails
5. **Real-time Updates:** Market data requires sub-minute refresh rates

## Future Enhancements

- Real-time trading signals
- Anomaly detection for insider trading patterns
- Integration with portfolio management systems
- Predictive models for earnings forecasts
- Multi-language support for global equities

While the spaces vs. tabs debate might not have a one-size-fits-all answer, it underscores the importance of consistency, readability, and team collaboration in software development. Whether a team chooses spaces, tabs, or a hybrid approach, the key is to make a conscious choice that serves the project's needs and to adhere to it throughout the codebase. As with many aspects of coding, communication and agreement among team members are paramount to navigating this classic programming debate.
